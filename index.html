<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Premium Kártya Webshop</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --accent-color: #4895ef;
            --danger-color: #f72585;
            --success-color: #4cc9f0;
            --warning-color: #f8961e;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --gray-color: #6c757d;
            --white-color: #ffffff;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            height: 100%;
            overflow-x: hidden;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--light-color);
            color: var(--dark-color);
            line-height: 1.6;
            min-height: 100%;
            position: relative;
            overflow-x: hidden;
            touch-action: manipulation;
        }

        #app {
            display: flex;
            min-height: 100vh;
            flex-direction: column;
        }

        /* Header Styles */
        header {
            background-color: var(--white-color);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 1rem;
            width: 100%;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            text-decoration: none;
            display: flex;
            align-items: center;
        }

        .logo i {
            margin-right: 0.5rem;
        }

        .nav-links {
            display: none;
            list-style: none;
        }

        .nav-links li {
            margin-left: 1.5rem;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--dark-color);
            font-weight: 500;
            transition: var(--transition);
            padding: 0.5rem 0;
            position: relative;
        }

        .nav-links a:hover {
            color: var(--primary-color);
        }

        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--primary-color);
            transition: var(--transition);
        }

        .nav-links a:hover::after {
            width: 100%;
        }

        .mobile-menu-btn {
            display: block;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--dark-color);
            padding: 0.5rem;
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding-bottom: 60px;
        }

        main {
            flex: 1;
            padding: 1rem;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .search-sort-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin: 1rem 0;
        }

        .search-container {
            width: 100%;
        }

        .search-input {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 2px solid #ddd;
            border-radius: 50px;
            font-size: 1rem;
            transition: var(--transition);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .sort-container {
            display: flex;
            gap: 0.5rem;
            width: 100%;
        }

        .sort-btn {
            flex: 1;
            padding: 0.8rem;
            background-color: var(--white-color);
            color: var(--dark-color);
            border: 2px solid #ddd;
            border-radius: 50px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }

        .sort-btn:hover {
            background-color: var(--primary-color);
            color: var(--white-color);
            border-color: var(--primary-color);
        }

        .sort-btn.active {
            background-color: var(--primary-color);
            color: var(--white-color);
            border-color: var(--primary-color);
        }

        /* Product Grid */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .product-card {
            background-color: var(--white-color);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .product-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--danger-color);
            color: var(--white-color);
            padding: 0.3rem 0.6rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 600;
            z-index: 1;
        }

        .product-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .product-info {
            padding: 1rem;
        }

        .product-title {
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .product-price {
            font-size: 1rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .product-stock {
            font-size: 0.8rem;
            color: var(--gray-color);
            margin-bottom: 0.5rem;
        }

        .product-actions {
            display: flex;
            justify-content: space-between;
        }

        .btn {
            display: inline-block;
            background-color: var(--primary-color);
            color: var(--white-color);
            padding: 0.6rem 1rem;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition);
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            width: 100%;
            text-align: center;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        /* Custom Button Styles */
        .custom-button {
            display: inline-block;
            background-color: var(--primary-color);
            color: var(--white-color);
            padding: 0.8rem 1.5rem;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition);
            margin: 1rem 0;
            text-align: center;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            box-shadow: var(--shadow);
        }

        .custom-button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        /* Shopping Cart Sidebar */
        .cart-sidebar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--white-color);
            box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.1);
            padding: 1rem;
            max-height: 80vh;
            overflow-y: auto;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            z-index: 1000;
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
        }

        .cart-sidebar.active {
            transform: translateY(0);
        }

        .sidebar-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .close-cart {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--dark-color);
        }

        .cart-items {
            margin-bottom: 1rem;
            max-height: 200px;
            overflow-y: auto;
        }

        .cart-item {
            display: flex;
            margin-bottom: 0.8rem;
            padding-bottom: 0.8rem;
            border-bottom: 1px solid #eee;
        }

        .cart-item-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 5px;
            margin-right: 0.8rem;
        }

        .cart-item-details {
            flex: 1;
        }

        .cart-item-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.2rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .cart-item-price {
            font-size: 0.8rem;
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .cart-item-quantity {
            display: flex;
            align-items: center;
        }

        .quantity-btn {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background-color: #f0f0f0;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .quantity-input {
            width: 35px;
            text-align: center;
            margin: 0 0.3rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 0.2rem;
        }

        .remove-item {
            background: none;
            border: none;
            color: var(--danger-color);
            cursor: pointer;
            font-size: 1rem;
            margin-left: auto;
            align-self: flex-start;
        }

        .cart-summary {
            background-color: #f9f9f9;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .summary-total {
            font-weight: 700;
            font-size: 1rem;
            border-top: 1px solid #ddd;
            padding-top: 0.5rem;
            margin-top: 0.5rem;
        }

        /* Discount Progress */
        .discount-progress-container {
            margin: 1rem 0;
        }

        .discount-progress {
            height: 8px;
            background-color: #f0f0f0;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .discount-progress-bar {
            height: 100%;
            background-color: var(--success-color);
            transition: width 0.3s ease;
        }

        .discount-milestones {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
        }

        .discount-milestone {
            position: relative;
            text-align: center;
            flex: 1;
        }

        .discount-milestone::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 50%;
            width: 2px;
            height: 5px;
            background-color: var(--gray-color);
        }

        .discount-milestone.active {
            color: var(--success-color);
            font-weight: bold;
        }

        .discount-milestone.active::before {
            background-color: var(--success-color);
            height: 8px;
        }

        /* Product Selection Options */
        .product-selection-options {
            margin: 1rem 0;
        }

        .selection-option {
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .selection-option:hover {
            border-color: var(--primary-color);
        }

        .selection-option.selected {
            border-color: var(--primary-color);
            background-color: rgba(67, 97, 238, 0.05);
        }

        .selection-option input {
            margin-right: 0.5rem;
        }

        /* Customer Name Input */
        .customer-name-container {
            margin: 1rem 0;
        }

        .customer-name-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .customer-name-input {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: var(--transition);
        }

        .customer-name-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        /* Special Requests Input */
        .special-requests-container {
            margin: 1rem 0;
        }

        .special-requests-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .special-requests-input {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: var(--transition);
            resize: none;
            height: 80px;
            font-family: 'Poppins', sans-serif;
        }

        .special-requests-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .char-counter {
            font-size: 0.8rem;
            color: var(--gray-color);
            text-align: right;
            margin-top: 0.3rem;
        }

        .char-counter.warning {
            color: var(--danger-color);
        }

        /* Coupon Form */
        .coupon-form {
            display: flex;
            margin-bottom: 1rem;
        }

        .coupon-input {
            flex: 1;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 5px 0 0 5px;
            font-size: 0.9rem;
        }

        .coupon-btn {
            padding: 0 1rem;
            background-color: var(--primary-color);
            color: var(--white-color);
            border: none;
            border-radius: 0 5px 5px 0;
            cursor: pointer;
            transition: var(--transition);
        }

        .coupon-btn:hover {
            background-color: var(--secondary-color);
        }

        /* Checkout Button */
        .checkout-btn {
            width: 100%;
            padding: 1rem;
            background-color: var(--success-color);
            color: var(--white-color);
            border: none;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 1rem;
        }

        .checkout-btn:hover {
            background-color: #3aa8d8;
        }

        /* Checkout Button - Disabled State */
        .checkout-btn:disabled {
            background-color: var(--gray-color);
            cursor: not-allowed;
        }

        /* Cart Toggle Button */
        .cart-toggle-btn {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            background-color: var(--primary-color);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            z-index: 999;
            border: none;
            cursor: pointer;
        }

        .cart-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--danger-color);
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        /* Overlay */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Chat Bot Container */
        .chat-bot-container {
            position: fixed;
            bottom: 80px;
            right: 20px;
            z-index: 1000;
            width: 300px;
            max-width: 90%;
            transition: all 0.3s ease;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .chat-bot-container.collapsed {
            height: 40px;
        }

        /* Chat Bot Toggle Button */
        .chat-bot-toggle {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 10px 15px;
            width: 100%;
            text-align: left;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-bot-toggle i {
            transition: transform 0.3s ease;
        }

        .chat-bot-container.collapsed .chat-bot-toggle i {
            transform: rotate(180deg);
        }

        /* Chat Bot Content */
        .chat-bot-content {
            background-color: white;
            height: 350px;
            display: flex;
            flex-direction: column;
        }

        /* Chat Messages */
        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .message {
            max-width: 80%;
            padding: 8px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .bot-message {
            background-color: #f0f0f0;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }

        .user-message {
            background-color: var(--primary-color);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }

        /* Chat Input */
        .chat-input-container {
            padding: 10px;
            border-top: 1px solid #eee;
            display: flex;
        }

        .chat-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 0.9rem;
            outline: none;
        }

        .chat-send-btn {
            background: none;
            border: none;
            color: var(--primary-color);
            font-size: 1.2rem;
            margin-left: 10px;
            cursor: pointer;
        }

        /* Quick Reply Buttons */
        .quick-replies {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            padding: 0 10px 10px;
        }

        .quick-reply-btn {
            background-color: #f0f0f0;
            border: none;
            border-radius: 15px;
            padding: 5px 10px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .quick-reply-btn:hover {
            background-color: #e0e0e0;
        }

        /* Recommendation Styles */
        .recommendation {
            background-color: rgba(67, 97, 238, 0.1);
            border-left: 3px solid var(--primary-color);
            padding: 10px;
            margin: 5px 0;
            border-radius: 0 5px 5px 0;
        }

        .recommendation-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .recommendation-price {
            font-size: 0.9rem;
            color: var(--dark-color);
            margin-bottom: 3px;
        }

        .recommendation-stock {
            font-size: 0.8rem;
            color: var(--gray-color);
            margin-bottom: 5px;
        }

        .recommendation-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 3px 8px;
            font-size: 0.8rem;
            cursor: pointer;
            margin-top: 5px;
        }

        .recommendation-btn:disabled {
            background-color: var(--gray-color);
            cursor: not-allowed;
        }

        /* Notification */
        .notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--primary-color);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            animation: fadeInOut 3s ease-in-out;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateX(-50%) translateY(20px); }
            10% { opacity: 1; transform: translateX(-50%) translateY(0); }
            90% { opacity: 1; transform: translateX(-50%) translateY(0); }
            100% { opacity: 0; transform: translateX(-50%) translateY(20px); }
        }

        /* Desktop styles */
        @media (min-width: 992px) {
            #app {
                flex-direction: row;
            }
            
            .main-content {
                padding-bottom: 0;
            }
            
            .cart-sidebar {
                position: sticky;
                top: 80px;
                height: calc(100vh - 80px);
                max-height: none;
                transform: none;
                border-radius: 0;
                width: 350px;
                box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
                border-left: 1px solid #eee;
            }
            
            .cart-toggle-btn {
                display: none;
            }
            
            .overlay {
                display: none;
            }
            
            .nav-links {
                display: flex;
            }
            
            .mobile-menu-btn {
                display: none;
            }
            
            .logo {
                font-size: 1.8rem;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 1.5rem;
            }
            
            .product-image {
                height: 200px;
            }
            
            .product-title {
                font-size: 1.1rem;
            }
            
            .product-price {
                font-size: 1.2rem;
            }
            
            .btn {
                padding: 0.8rem 1.5rem;
                font-size: 1rem;
                width: auto;
            }
            
            .search-sort-container {
                flex-direction: row;
                align-items: center;
            }
            
            .search-container {
                flex: 1;
            }
            
            .sort-container {
                width: auto;
            }

            /* Chat bot adjustments for desktop */
            .chat-bot-container {
                bottom: 20px;
                right: 20px;
            }
        }

        /* Tablet styles */
        @media (min-width: 768px) and (max-width: 991px) {
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .product-image {
                height: 180px;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="main-content">
            <!-- Header -->
            <header>
                <nav class="navbar">
                    <a href="https://petykoweb.github.io/bolt/" class="logo">
                        <i class="fas fa-cards"></i> KártyaBolt
                    </a>

                    <ul class="nav-links">
                        <li><a href="https://petykoweb.github.io/bolt/" class="active">Főoldal</a></li>
                        <li><a href="#">Termékek</a></li>
                    </ul>
                    <button class="mobile-menu-btn">
                        <i class="fas fa-bars"></i>
                    </button>
                </nav>
            </header>

            <!-- Main Content -->
            <main>
                <!-- Search and Sort Box -->
                <div class="search-sort-container">
                    <div class="search-container">
                        <input type="text" class="search-input" placeholder="Termék keresése..." id="search-input" onkeyup="searchProducts()">
                    </div>
                    <div class="sort-container">
                        <button class="sort-btn" onclick="sortProducts('price-desc')">
                            <i class="fas fa-arrow-down"></i> Ár
                        </button>
                        <button class="sort-btn" onclick="sortProducts('price-asc')">
                            <i class="fas fa-arrow-up"></i> Ár
                        </button>
                    </div>
                </div>

                <!-- Product Grid -->
                <div class="products-grid" id="products-grid">
                    <!-- Products will be loaded here -->
                </div>

                <!-- Back to Home Button -->
                <a href="https://petykoweb.github.io/bolt/" class="custom-button">Vissza a fő oldalra</a>
            </main>
        </div>

        <!-- Shopping Cart Sidebar -->
        <div class="cart-sidebar" id="cart-sidebar">
            <h3 class="sidebar-title">
                <span>Bevásárlókosár</span>
                <button class="close-cart" onclick="toggleCart()">&times;</button>
            </h3>
            <div class="cart-items" id="cart-items">
                <!-- Cart items will be loaded here -->
            </div>
            <div class="cart-summary">
                <div class="summary-row">
                    <span>Részösszeg:</span>
                    <span id="subtotal">0 Ft</span>
                </div>
                <div class="summary-row">
                    <span>Kedvezmény:</span>
                    <span id="discount">-0 Ft</span>
                </div>
                
                <!-- Discount Progress -->
                <div class="discount-progress-container">
                    <div class="discount-progress">
                        <div class="discount-progress-bar" id="discount-progress-bar"></div>
                    </div>
                    <div class="discount-milestones">
                        <div class="discount-milestone" id="milestone-2500">2 500 Ft<br>-170 Ft</div>
                        <div class="discount-milestone" id="milestone-5000">5 000 Ft<br>-5%</div>
                        <div class="discount-milestone" id="milestone-10000">10 000 Ft<br>-7%</div>
                    </div>
                </div>
                
                <div class="summary-row summary-total">
                    <span>Összesen:</span>
                    <span id="total">0 Ft</span>
                </div>
            </div>
            
            <!-- Product Selection Options -->
            <div class="product-selection-options">
                <label class="form-label">Termék kiválasztása:</label>
                <div class="selection-option selected" onclick="selectOption(this, 'live')">
                    <input type="radio" name="selection" checked> 
                    <strong>Élő adásban választom ki</strong>
                    <p class="mb-0 mt-1">Az eladó segít kiválasztni a legjobb példányokat</p>
                </div>
                <div class="selection-option" onclick="selectOption(this, 'seller')">
                    <input type="radio" name="selection"> 
                    <strong>Az eladó választ ki nekem</strong>
                    <p class="mb-0 mt-1">Megbízunk abban, hogy a legjobb minőségű termékeket kapom</p>
                </div>
            </div>
            
            <!-- Customer Name -->
            <div class="customer-name-container">
                <label class="customer-name-label">Név:</label>
                <input type="text" class="customer-name-input" id="customer-name" placeholder="Kérjük adja meg a nevét" required>
            </div>
            
            <!-- Special Requests -->
            <div class="special-requests-container">
                <label class="special-requests-label">Egyéb kívánságok (max 100 karakter):</label>
                <textarea class="special-requests-input" id="special-requests" placeholder="Ide írhatja további kívánságait..." maxlength="100"></textarea>
                <div class="char-counter" id="char-counter">0/100</div>
            </div>
            
            <!-- Coupon Form -->
            <div class="coupon-form">
                <input type="text" class="coupon-input" placeholder="Kuponkód" id="coupon-code">
                <button class="coupon-btn" onclick="applyCoupon()">Alkalmaz</button>
            </div>
            
            <!-- Checkout Button -->
            <button class="checkout-btn" id="checkout-btn" onclick="checkout()">Rendelés leadása</button>
        </div>

        <!-- Mobile Cart Toggle Button -->
        <button class="cart-toggle-btn" onclick="toggleCart()">
            <i class="fas fa-shopping-cart"></i>
            <span class="cart-badge" id="cart-badge">0</span>
        </button>

        <!-- Overlay -->
        <div class="overlay" id="overlay" onclick="toggleCart()"></div>
    </div>

    <!-- Chat Bot Container -->
    <div class="chat-bot-container collapsed" id="chat-bot-container">
        <button class="chat-bot-toggle" onclick="toggleChatBot()">
            <span>Kártya Választó Segítő</span>
            <i class="fas fa-chevron-down"></i>
        </button>
        <div class="chat-bot-content">
            <div class="chat-messages" id="chat-messages">
                <!-- Chat messages will appear here -->
            </div>
            <div class="quick-replies" id="quick-replies">
                <!-- Quick reply buttons will appear here -->
            </div>
            <div class="chat-input-container">
                <input type="text" class="chat-input" id="chat-input" placeholder="Írd ide a kérdésed..." onkeypress="handleChatInputKey(event)">
                <button class="chat-send-btn" onclick="sendChatMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        emailjs.init("uO9ZiOSBCkDFXWLh4");

        // Application State
        const state = {
            user: null,
            cart: [],
            products: [
                //{ id: 1, name: "mgk 2020/21", price: 1350, stock: 3, image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT3c53Mm_GEB3Mk4ounAzw9wJDiANGBN2MnuA&s", category: "foci" },
                
               // { id: 2, name: "Star Wars", price: 1200, stock: 4, image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSEBDTrELRsV0aFciqVSgajLMweS3LU4345mA&s", category: "film" },
                
                { id: 3, name: "Nba Hops box 2022/23", price: 16000, stock: 1, image: "https://encrypted-tbn3.gstatic.com/shopping?q=tbn:ANd9GcTHiBca0Vlord2wZIiPylCrpWw_eqs7wnSjeqYQi_nYlZdzaIY0lX22c9_pPYHlTpECvx4jnN1VKF6G9NKSIoyHmuDim31eMuDzdcFCMobUYD2DrTSmCulo", category: "kosár" },
               // { id: 4, name: "Super Stars", price: 1250, stock: 2, image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRJZRVza8JC1PXUYYrYK0zinHFzbMZB8ssHPg&s", category: "foci" },
                
                //  { id: 5, name: "Liverpool fan set", price: 8900, stock: 1, image: "https://static.topps.com/media/catalog/product/cache/85d1d431b9dc807689df3bf5f08e33f8/1/t/1t25fns_liverpool_fc_deck_box_visual.png", category: "foci", numbered: true },
                //{ id: 7, name: "Match Attax 101", price: 550, stock: 6, image: "https://s13emagst.akamaized.net/products/74410/74409020/images/res_757d9abaabeffddcd3d5f9bd087da45d.jpg?width=720&height=720&hash=0D9391BB02509421D9CA08EB5C7446DE", category: "foci" },
                { id: 8, name: "Panini Top Class", price: 600, stock: 8, image: "https://images-rajhraciek-cdn.rshop.sk/md/products/43e4bb96f4361b3f737c2b54bd648b36.jpg", category: "foci" },
                //{ id: 10, name: "Nfl", price: 1900, stock: 1, image: "https://upload.wikimedia.org/wikipedia/en/thumb/a/a2/National_Football_League_logo.svg/175px-National_Football_League_logo.svg.png", category: "hockey" },
              { id: 11, name: "bundesliga topps chrome", price: 1400, stock: 11, image: "https://encrypted-tbn3.gstatic.com/shopping?q=tbn:ANd9GcTu_SKgEnX6H7hawwuMy7t9nt0TIuKLqtkE6x3mhhpXVoDY2JWC_aX9Z0COTip1iZVrBjBjnCsCqHBEBPzE96O0Q0Fm6lBc6EFd2bK1nIfTDBxW3xee2uwk", category: "foci" },
                
                { id: 12, name: "Score 22/23 zöld", price: 1800, stock: 16, image: "https://paninishop-16eb6.kxcdn.com/media/image/22/6c/67/panini-fifa-score-2022-23-retailbox_600x600.png", category: "foci" },

                 { id: 50, name: "Score 21/22 kék", price: 1850, stock: 10, image: "https://sportkartyabolt.hu/img/8974/20089/440x440,r/2021-22-Panini-Score-FIFA-Soccer-RETAIL-pack-focis-kartya-csomag.webp?time=1726817211", category: "foci" },
               
                { id: 13, name: "Score 22/23 serie A", price: 1500, stock: 7, image: "https://www.paninihungary.com/media/catalog/product/cache/2d16730310b7945c46ddd1ca513e3c42/b/u/bundle201445b10h20_0_1_1.jpg", category: "foci" },
                //{ id: 16, name: "Donruss elite 22/23", price: 1850, stock: 1, image: "https://sportkartyabolt.hu/img/8974/20072/2022-23_Panini_Donruss-Elite_Soccer_RETAIL_pack.webp", category: "foci" },
                { id: 19, name: "Topps bundesliga 21/22", price: 1300, stock: 3, image: "https://encrypted-tbn3.gstatic.com/shopping?q=tbn:ANd9GcQvfjLi6HLgIce4kNfwrVLPA-bDZvZqX12_j9ETbLzOYbrqdnT6ETRBKg0tgLSz42oH9Pr_iJxl4kXqDKES3C-MiZcY3C4cAyLxmdRyYWTIjfDCNy8Pmloi", category: "foci" },
                { id: 20, name: "Nba '95", price: 2300, stock: 5, image: "https://i.ebayimg.com/thumbs/images/g/1l0AAeSw3cVnxm~R/s-l400.webp", category: "kosár" },
                
              //  { id: 21, name: "Mgk 24/25", price: 800, stock: 18, image: "https://confitelia.com/6983-large_default/tarjetas-megacracks-liga-2024-25-de-panini.jpg", category: "foci" },
                //{ id: 22, name: "Man united fan set", price: 8900, stock: 1, image: "https://static.topps.com/media/catalog/product/cache/85d1d431b9dc807689df3bf5f08e33f8/t/2/t25fns_manchester_united_deck_box_visual.png", category: "foci", numbered: true },
            
                //{ id: 23, name: "Nba draft 94", price: 1750, stock: 3, image: "https://i.ebayimg.com/images/g/dp0AAOSwLOdn9n2X/s-l1600.webp", category: "kosar", numbered: true },
                
             //   { id: 24, name: "Euro 2016", price: 550, stock: 4, image: "https://www.zozone.hu/vizjel/watermark.php?path=https://www.zozone.hu/nagy/17/25051_1.jpg", category: "foci", numbered: true },
                //{ id: 25, name: "Score Angol", price: 2100, stock: 2, image: "https://i.ebayimg.com/images/g/n1sAAOSwLbxloWHj/s-l1600.webp", category: "foci", numbered: true },
           //     { id: 26, name: "Fifa Adrenalyn", price: 600, stock: 9, image: "https://www.jatekraj.hu/panini-fifa-365-2020-2021-adrenalyn-kartyak-p259079#", category: "foci", numbered: true },
                //{ id: 27, name: "Topps Ucc 22/23", price: 1500, stock: 2, image: "https://cobracard.hu/wp-content/uploads/2023/06/793066_0001.jpg.webp", category: "foci", numbered: true },
                
      //      { id: 28, name: "Japán pokemon",price: 1150,stock: 5, image: "https://i.ebayimg.com/images/g/6RgAAOSwOT1nieZA/s-l1600.webp", category: "pokemon", numbered: true },
                
        //   { id: 29, name: "obsidian pokemon",price: 2000,stock: 2, image: "https://image.alza.cz/products/HRAls2164/HRAls2164-03.jpg?width=1400&height=1400", category: "pokemon", numbered: true },
                
           //     { id: 30, name: "Fifa Adrenalyn 2017",price: 850,stock: 9, image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQJIbIyyiz86NdKPuFGjJ3MuHNhgTg-yZIgFg&s", category: "foci", numbered: true },
                
            //    { id: 31, name: "Haunted Hopps",price: 350,stock: 9, image: "https://cobracard.hu/wp-content/uploads/2024/09/Picture41.png", category: "foci", numbered: true },
                
           //    { id: 32, name: "Euro 2020",price: 900,stock: 5, image: "https://fociskartya.cdn.shoprenter.hu/custom/fociskartya/image/cache/w700h700wt1/product/KOEURO21/axl-euro-21ko-NORDIC%20STARTER.jpg.webp?lastmod=1695035749.1742028597", category: "foci", numbered: true },
                
                { id: 33, name: "Pokemon olcsó",price: 400,stock: 20, image: "blob:https://www.facebook.com/7e3a8df7-3661-475a-9b28-6ee54f210571", category: "pokemon", numbered: true },
               
                
                //{ id: 34, name: "Pokemon stickers",price: 450,stock: 3, image: "https://i.ebayimg.com/images/g/Q0YAAOSwhP9grPdZ/s-l640.jpg", category: "pokemon", numbered: true },
                
                //{ id: 34, name: "Panini 18/19 seria",price: 400,stock: 4, image: "gg", category: "foci", numbered: true },
                
                { id: 35, name: " 2022-23 TOPPS Chrome UEFA Club Competitions Soccer Cards",price: 1500,stock: 8, image: "https://s13emagst.akamaized.net/products/89843/89842415/images/res_2b63a91971c4f62a3cb80db9d06742a8.jpg", category: "foci", numbered: true },

                { id: 36, name: " Panini euro 2012",price: 700,stock: 4, image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR4WqwO-f3mPW_efZN5LY6UdA-GRFiI2YavHA&s", category: "foci", numbered: true },

           //     { id: 37, name: " Podium Barcelona",price:  3450,stock: 2, image: "https://paninishop-16eb6.kxcdn.com/media/image/51/7e/7e/panini-fc-barcelona-podium-2021-22-megabox-pack-1GZ3kmHCLKMPCd_800x800.jpg", category: "foci", numbered: true },

              //  { id: 38, name: "Podiem Real Madrid",price: 3700,stock: 1, image: "https://www.paniniportugal.com/media/blog/blog-ES/coleccionables/PODIUM/PODIUM_RMADRID_2021-22_MEGASOBRE.jpg", category: "foci", numbered: true },

                { id: 39, name: "Laliga 2024/25",price: 700,stock: 15, image: "https://krakenshop.pl/images/lt521/3000-4000/Saszetka-Panini-La-Liga-Adrenalyn-L-2024-25-Karty-pilkarskie_%5B3162%5D_480.jpg", category: "foci", numbered: true },

                { id: 40, name: "One Piece",price: 1900,stock: 5, image: "https://images.whatnot.com/fit-in/3840x0/filters:format(webp)/listings/0-A9C79E32-C8E0-4596-B9D5-D0D77DA461A4-2c5c8191-8912-4f28-9d1b-69c09832b6b2.jpeg", category: "film", numbered: true },

             //   { id: 41, name: "Metal type stacking tin",price: 3950,stock: 1, image: "https://i.ebayimg.com/images/g/O2oAAOSweZFm50yw/s-l1200.jpg", category: "pokemon", numbered: true },

                { id: 42, name: "journey together",price: 2450,stock: 2, image: "https://www.foon.hu/_next/image?url=https%3A%2F%2Finstance13.admin.grandus.sk%2Ffiles%2Fphoto%2F2025-03-25%2Fa28d5f%2F1127326%2F680x440.jpg%3Fv%3D2025-03-25-2013-3A01-3A33&w=750&q=75", category: "pokemon", numbered: true },

            //    { id: 43, name: "vanda vision",price: 1350,stock: 1, image: "https:///i.ebayimg.com/images/g/1x0AAOSwCTBln~yY/s-l400.jpg", category: "pokemon", numbered: true },

                { id: 44, name: "Topps ucc flag ship 24/25",price: 1525,stock: 5, image: "http://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQRzuD3YaEvytkZhx1TUIlykUemU3JBUgVe92D2cFIGLBUDq_OS", category: "foci", numbered: true },

                { id: 41, name: "Topps ucc flag ship 22/23",price: 1525,stock: 8, image: "https://www.cambetcards.hu/img/99569/833669/500x500,r/833669.jpg?time=1725876636", category: "foci", numbered: true },

                 { id: 46, name: "Chronieles",price: 3600,stock: 2, image: "https://sportkartyabolt.hu/img/8974/20074/275x275,r/2022-23_Panini_Chronicles_Soccer_Multi_Cello_Jumbo_Pack.webp?time=1728288540", category: "foci", numbered: true },

                { id: 47, name: "Show time",price: 2300,stock: 5, image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR0BX8aETCgGx91SZVfCSHsZi4Uq0ve8DQ11__jJdHwsbC7xTp5", category: "foci", numbered: true },

                { id: 48, name: "Francia Score",price: 1400,stock: 3, image: "https://i.ebayimg.com/images/g/~ioAAOSwxp1mLjHa/s-l225.jpg", category: "foci", numbered: true },

                { id: 60, name: "pókember",price: 1500,stock: 10, image: "https://encrypted-tbn3.gstatic.com/shopping?q=tbn:ANd9GcTjXBxcYVMjz5RT0XNjwkaJ8T8mO68iSQDAbvmuYkUaZoW3JDd-jAkJia090sy2Ts6l1_eENROGh-YJaQx4BXiiRcoqO5JcLLiCH1tpR5NgyYhbdi4lXvrHgb5f&usqp=CAc", category: "foci", numbered: true },

                { id: 61, name: "pokemon japán több féle ",price: ,stock: 9, image: "https://encrypted-tbn2.gstatic.com/images?q=tbn:ANd9GcTnsVrdLn_Pfg565EowyyOOAlNKYl2KyLSLvTBTLEW50of51tX8", category: "pokemon", numbered: true },

               
            ],
            coupons: {
                "petyko": 0.01,
                "break": 0.005,
                "barca": 0.015,
                "real": 0.02
            },
            appliedCoupon: null,
            selectionType: 'live',
            searchTerm: '',
            sortType: null,
            specialRequests: ''
        };

        // Chat Bot State
        const chatBotState = {
            isOpen: false,
            conversation: [
                {
                    sender: 'bot',
                    message: 'Szia! Én vagyok a kártya választó segítő. Miben segíthetek?',
                    quickReplies: [
                        '1500 Ft alatt ajánlj kártyát',
                        '2500 Ft alatt ajánlj kártyát',
                        '2500 Ft felett ajánlj kártyát',
                        'Foci kártyákat keresek',
                        'Garantált számozott kártyát szeretnék'
                    ]
                }
            ],
            currentBudget: null,
            currentCategory: null,
            wantsNumbered: false
        };

        // DOM Elements
        const elements = {
            productGrid: document.getElementById('products-grid'),
            cartSidebar: document.getElementById('cart-sidebar'),
            cartItems: document.getElementById('cart-items'),
            subtotal: document.getElementById('subtotal'),
            discount: document.getElementById('discount'),
            total: document.getElementById('total'),
            discountProgressBar: document.getElementById('discount-progress-bar'),
            customerName: document.getElementById('customer-name'),
            specialRequests: document.getElementById('special-requests'),
            charCounter: document.getElementById('char-counter'),
            couponCode: document.getElementById('coupon-code'),
            searchInput: document.getElementById('search-input'),
            sortButtons: document.querySelectorAll('.sort-btn'),
            cartBadge: document.getElementById('cart-badge'),
            overlay: document.getElementById('overlay'),
            cartToggleBtn: document.querySelector('.cart-toggle-btn'),
            checkoutBtn: document.getElementById('checkout-btn'),
            chatContainer: document.getElementById('chat-bot-container'),
            chatMessages: document.getElementById('chat-messages'),
            chatInput: document.getElementById('chat-input'),
            quickReplies: document.getElementById('quick-replies')
        };

        // Initialize the application
        function init() {
            loadCart();
            renderProducts();
            updateCartView();
            
            // Prevent zooming on input focus on mobile
            elements.customerName.addEventListener('focus', preventZoom);
            elements.couponCode.addEventListener('focus', preventZoom);
            elements.specialRequests.addEventListener('focus', preventZoom);
            
            // Set up character counter for special requests
            elements.specialRequests.addEventListener('input', updateCharCounter);
            
            // Initialize chat bot
            initChatBot();
        }

        function isMobile() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        function preventZoom() {
            document.querySelector('meta[name="viewport"]').setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0');
        }

        function updateCharCounter() {
            const currentLength = elements.specialRequests.value.length;
            const maxLength = elements.specialRequests.maxLength;
            elements.charCounter.textContent = `${currentLength}/${maxLength}`;
            
            if (currentLength > maxLength * 0.8) {
                elements.charCounter.classList.add('warning');
            } else {
                elements.charCounter.classList.remove('warning');
            }
            
            state.specialRequests = elements.specialRequests.value;
        }

        // Toggle cart visibility on mobile
        function toggleCart() {
            elements.cartSidebar.classList.toggle('active');
            elements.overlay.classList.toggle('active');
            
            if (elements.cartSidebar.classList.contains('active')) {
                document.body.style.overflow = 'hidden';
            } else {
                document.body.style.overflow = '';
            }
        }

        // Load cart from localStorage
        function loadCart() {
            const savedCart = localStorage.getItem('cart');
            if (savedCart) {
                state.cart = JSON.parse(savedCart);
            }
        }

        // Save cart to localStorage
        function saveCart() {
            localStorage.setItem('cart', JSON.stringify(state.cart));
        }

        // Sort products
        function sortProducts(sortType) {
            state.sortType = sortType;
            
            // Update active button state
            elements.sortButtons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.includes('Ár') && 
                    ((sortType === 'price-desc' && btn.textContent.includes('↓')) || 
                     (sortType === 'price-asc' && btn.textContent.includes('↑')))) {
                    btn.classList.add('active');
                }
            });
            
            renderProducts();
        }

        // Render products based on search and sort
        function renderProducts() {
            elements.productGrid.innerHTML = '';

            let filteredProducts = [...state.products];
            
            // Apply search filter
            if (state.searchTerm) {
                filteredProducts = filteredProducts.filter(product => 
                    product.name.toLowerCase().includes(state.searchTerm.toLowerCase())
                );
            }
            
            // Apply sorting
            if (state.sortType === 'price-desc') {
                filteredProducts.sort((a, b) => b.price - a.price);
            } else if (state.sortType === 'price-asc') {
                filteredProducts.sort((a, b) => a.price - b.price);
            }

            filteredProducts.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card fade-in';
                productCard.innerHTML = `
                    <img src="${product.image}" alt="${product.name}" class="product-image">
                    <div class="product-info">
                        <h3 class="product-title">${product.name}</h3>
                        <div class="product-price">${product.price.toLocaleString()} Ft</div>
                        <div class="product-stock">Raktáron: ${product.stock} db</div>
                        <div class="product-actions">
                            <button class="btn btn-sm" onclick="addToCart(${product.id})" ${product.stock <= 0 ? 'disabled' : ''}>
                                <i class="fas fa-cart-plus"></i> ${product.stock <= 0 ? 'Nincs raktáron' : 'Kosárba'}
                            </button>
                        </div>
                    </div>
                `;
                elements.productGrid.appendChild(productCard);
            });
        }

        // Search products
        function searchProducts() {
            state.searchTerm = elements.searchInput.value;
            renderProducts();
        }

        // Add product to cart
        function addToCart(productId) {
            const product = state.products.find(p => p.id === productId);
            
            if (!product) return;
            
            if (product.stock <= 0) {
                showNotification('Ez a termék jelenleg nincs raktáron!');
                return;
            }
            
            const existingItem = state.cart.find(item => item.id === productId);
            
            if (existingItem) {
                if (existingItem.quantity >= 5) {
                    showNotification('Maximum 5 db vásárolható egy termékből!');
                    return;
                }
                existingItem.quantity++;
            } else {
                state.cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    image: product.image,
                    quantity: 1
                });
            }
            
            product.stock--;
            saveCart();
            updateCartView();
            renderProducts();
            
            showNotification('Termék hozzáadva a kosárhoz!');
        }

        // Show notification
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Remove after animation
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Remove item from cart
        function removeFromCart(productId) {
            const itemIndex = state.cart.findIndex(item => item.id === productId);
            
            if (itemIndex === -1) return;
            
            const product = state.products.find(p => p.id === productId);
            if (product) {
                product.stock += state.cart[itemIndex].quantity;
            }
            
            state.cart.splice(itemIndex, 1);
            saveCart();
            updateCartView();
            renderProducts();
        }

        // Update item quantity in cart
        function updateQuantity(productId, newQuantity) {
            newQuantity = parseInt(newQuantity);
            
            if (isNaN(newQuantity)) {
                return;
            }
            
            // If quantity is 0, remove the item
            if (newQuantity === 0) {
                removeFromCart(productId);
                return;
            }
            
            // Validate quantity
            if (newQuantity < 1 || newQuantity > 5) {
                return;
            }
            
            const cartItem = state.cart.find(item => item.id === productId);
            const product = state.products.find(p => p.id === productId);
            
            if (!cartItem || !product) return;
            
            const quantityDiff = newQuantity - cartItem.quantity;
            
            if (product.stock < quantityDiff) {
                showNotification('Nincs elég termék a raktáron!');
                return;
            }
            
            cartItem.quantity = newQuantity;
            product.stock -= quantityDiff;
            
            saveCart();
            updateCartView();
            renderProducts();
        }

        // Update cart view
        function updateCartView() {
            elements.cartItems.innerHTML = '';
            
            if (state.cart.length === 0) {
                elements.cartItems.innerHTML = '<p>A kosár üres.</p>';
                updateCartSummary();
                elements.cartBadge.textContent = '0';
                return;
            }
            
            state.cart.forEach(item => {
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <img src="${item.image}" alt="${item.name}" class="cart-item-image">
                    <div class="cart-item-details">
                        <h4 class="cart-item-title">${item.name}</h4>
                        <div class="cart-item-price">${item.price.toLocaleString()} Ft</div>
                        <div class="cart-item-quantity">
                            <button class="quantity-btn" onclick="updateQuantity(${item.id}, ${item.quantity - 1})">-</button>
                            <input type="number" class="quantity-input" value="${item.quantity}" min="1" max="5" 
                                   onchange="updateQuantity(${item.id}, this.value)">
                            <button class="quantity-btn" onclick="updateQuantity(${item.id}, ${item.quantity + 1})">+</button>
                        </div>
                    </div>
                    <button class="remove-item" onclick="removeFromCart(${item.id})">&times;</button>
                `;
                elements.cartItems.appendChild(cartItem);
            });
            
            // Update cart badge
            const totalItems = state.cart.reduce((sum, item) => sum + item.quantity, 0);
            elements.cartBadge.textContent = totalItems;
            
            updateCartSummary();
        }

        // Update cart summary
        function updateCartSummary() {
            const subtotal = state.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            // Calculate automatic discounts
            let webDiscount = 0;
            if (subtotal >= 10000) {
                webDiscount = subtotal * 0.07;
            } else if (subtotal >= 5000) {
                webDiscount = subtotal * 0.05;
            } else if (subtotal >= 2500) {
                webDiscount = 170;
            }
            
            // Calculate coupon discount
            let couponDiscount = 0;
            if (state.appliedCoupon) {
                couponDiscount = subtotal * state.coupons[state.appliedCoupon];
            }
            
            const totalDiscount = webDiscount + couponDiscount;
            const total = subtotal - totalDiscount;
            
            // Update UI
            elements.subtotal.textContent = subtotal.toLocaleString() + ' Ft';
            elements.discount.textContent = totalDiscount > 0 ? '-' + totalDiscount.toLocaleString() + ' Ft' : '0 Ft';
            elements.total.textContent = total.toLocaleString() + ' Ft';
            
            // Update discount progress bar
            updateDiscountProgress(subtotal);
        }

        // Update discount progress
        function updateDiscountProgress(subtotal) {
            const progressBar = elements.discountProgressBar;
            const milestones = [
                { element: document.getElementById('milestone-2500'), value: 2500 },
                { element: document.getElementById('milestone-5000'), value: 5000 },
                { element: document.getElementById('milestone-10000'), value: 10000 }
            ];
            
            // Calculate progress percentage
            let progressPercentage = 0;
            if (subtotal >= 10000) {
                progressPercentage = 100;
            } else if (subtotal >= 5000) {
                progressPercentage = 50 + ((subtotal - 5000) / 5000 * 50);
            } else {
                progressPercentage = (subtotal / 5000 * 50);
            }
            progressBar.style.width = `${progressPercentage}%`;
            
            // Update milestone active states
            milestones.forEach(milestone => {
                if (subtotal >= milestone.value) {
                    milestone.element.classList.add('active');
                } else {
                    milestone.element.classList.remove('active');
                }
            });
        }

        // Apply coupon code
        function applyCoupon() {
            const code = elements.couponCode.value.trim();
            
            if (state.coupons[code]) {
                state.appliedCoupon = code;
                updateCartSummary();
                showNotification('Kuponkód sikeresen alkalmazva!');
            } else {
                showNotification('Érvénytelen kuponkód!');
            }
            
            elements.couponCode.value = '';
        }

        // Select product selection option
        function selectOption(element, type) {
            document.querySelectorAll('.selection-option').forEach(opt => {
                opt.classList.remove('selected');
                opt.querySelector('input').checked = false;
            });
            
            element.classList.add('selected');
            element.querySelector('input').checked = true;
            state.selectionType = type;
        }

        // Checkout process
        function checkout() {
            if (state.cart.length === 0) {
                showNotification('A kosár üres!');
                return;
            }
            
            const customerName = elements.customerName.value.trim();
            if (!customerName) {
                showNotification('Kérjük adja meg a nevét!');
                return;
            }
            
            // Disable checkout button during processing
            elements.checkoutBtn.disabled = true;
            elements.checkoutBtn.textContent = 'Feldolgozás...';
            
            // Prepare order data
            const subtotal = state.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            // Calculate discounts
            let webDiscount = 0;
            if (subtotal >= 10000) {
                webDiscount = subtotal * 0.07;
            } else if (subtotal >= 5000) {
                webDiscount = subtotal * 0.05;
            } else if (subtotal >= 2500) {
                webDiscount = 170;
            }
            
            let couponDiscount = 0;
            if (state.appliedCoupon) {
                couponDiscount = subtotal * state.coupons[state.appliedCoupon];
            }
            
            const totalDiscount = webDiscount + couponDiscount;
            const total = subtotal - totalDiscount;
            
            // Prepare order items
            const orderItems = state.cart.map(item => 
                `${item.name} - ${item.price.toLocaleString()} Ft x ${item.quantity}`
            ).join('\n');
            
            // Prepare email template
            const templateParams = {
                user_name: customerName,
                message: `Vásárló neve: ${customerName}\n\nRendelés:\n${orderItems}\n\nÖsszesen: ${subtotal.toLocaleString()} Ft\nWebes kedvezmény: -${webDiscount.toLocaleString()} Ft\nKuponkód kedvezmény: -${couponDiscount.toLocaleString()} Ft\nFizetendő: ${total.toLocaleString()} Ft\nTermék kiválasztása: ${state.selectionType === 'live' ? 'Élő adásban választom ki' : 'Eladó választ ki'}\n\nEgyéb kívánságok:\n${state.specialRequests || 'Nincsenek megadva'}`,
                email: "petykopetyko3@gmail.com"
            };
            
            // Send email
            emailjs.send("service_kyybcza", "template_o12ky0r", templateParams)
                .then(response => {
                    // Show success message
                    elements.checkoutBtn.textContent = 'Sikeres rendelés!';
                    
                    // Wait for 3 seconds before clearing
                    setTimeout(() => {
                        // Clear cart after successful order
                        state.cart.forEach(item => {
                            const product = state.products.find(p => p.id === item.id);
                            if (product) {
                                product.stock += item.quantity;
                            }
                        });
                        
                        state.cart = [];
                        state.appliedCoupon = null;
                        state.specialRequests = '';
                        elements.specialRequests.value = '';
                        updateCharCounter();
                        saveCart();
                        updateCartView();
                        renderProducts();
                        
                        // Reset checkout button
                        elements.checkoutBtn.disabled = false;
                        elements.checkoutBtn.textContent = 'Rendelés leadása';
                        
                        // Close cart on mobile
                        if (isMobile()) {
                            toggleCart();
                        }
                    }, 3000);
                }, error => {
                    showNotification('Hiba történt a rendelés elküldése során: ' + error.text);
                    elements.checkoutBtn.disabled = false;
                    elements.checkoutBtn.textContent = 'Rendelés leadása';
                });
        }

        /* CHAT BOT FUNCTIONS */

        // Initialize Chat Bot
        function initChatBot() {
            renderChatMessages();
            renderQuickReplies();
            
            // Auto-open on desktop
            if (window.innerWidth > 768) {
                toggleChatBot();
            }
        }

        // Toggle Chat Bot visibility
        function toggleChatBot() {
            chatBotState.isOpen = !chatBotState.isOpen;
            elements.chatContainer.classList.toggle('collapsed');
            
            if (chatBotState.isOpen) {
                // Scroll to bottom when opening
                setTimeout(() => {
                    elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
                }, 100);
            }
        }

        // Render Chat Messages
        function renderChatMessages() {
            elements.chatMessages.innerHTML = '';
            
            chatBotState.conversation.forEach(msg => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${msg.sender}-message`;
                messageDiv.textContent = msg.message;
                
                // Add recommendations if they exist
                if (msg.recommendations) {
                    const recommendationsDiv = document.createElement('div');
                    recommendationsDiv.className = 'recommendations';
                    
                    msg.recommendations.forEach(rec => {
                        const recDiv = document.createElement('div');
                        recDiv.className = 'recommendation';
                        recDiv.innerHTML = `
                            <div class="recommendation-title">${rec.name}</div>
                            <div class="recommendation-price">Ár: ${rec.price.toLocaleString()} Ft</div>
                            <div class="recommendation-stock">${rec.stock > 0 ? 'Raktáron: ' + rec.stock + ' db' : 'Nincs raktáron'}</div>
                            <button class="recommendation-btn" onclick="addToCart(${rec.id})" ${rec.stock <= 0 ? 'disabled' : ''}>
                                <i class="fas fa-cart-plus"></i> Kosárba
                            </button>
                        `;
                        recommendationsDiv.appendChild(recDiv);
                    });
                    
                    messageDiv.appendChild(recommendationsDiv);
                }
                
                elements.chatMessages.appendChild(messageDiv);
            });
            
            // Scroll to bottom
            elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
        }

        // Render Quick Reply Buttons
        function renderQuickReplies() {
            const lastMessage = chatBotState.conversation[chatBotState.conversation.length - 1];
            
            if (!lastMessage.quickReplies || lastMessage.quickReplies.length === 0) {
                elements.quickReplies.style.display = 'none';
                return;
            }
            
            elements.quickReplies.style.display = 'flex';
            elements.quickReplies.innerHTML = '';
            
            lastMessage.quickReplies.forEach(reply => {
                const button = document.createElement('button');
                button.className = 'quick-reply-btn';
                button.textContent = reply;
                button.onclick = () => {
                    addUserMessage(reply);
                    processUserInput(reply);
                };
                elements.quickReplies.appendChild(button);
            });
        }

        // Add User Message to Chat
        function addUserMessage(message) {
            chatBotState.conversation.push({
                sender: 'user',
                message: message
            });
            
            elements.chatInput.value = '';
            renderChatMessages();
            renderQuickReplies();
        }

        // Add Bot Message to Chat
        function addBotMessage(message, quickReplies = [], recommendations = null) {
            chatBotState.conversation.push({
                sender: 'bot',
                message: message,
                quickReplies: quickReplies,
                recommendations: recommendations
            });
            
            renderChatMessages();
            renderQuickReplies();
        }

        // Handle Chat Input Key Press
        function handleChatInputKey(event) {
            if (event.key === 'Enter') {
                sendChatMessage();
            }
        }

        // Send Chat Message
        function sendChatMessage() {
            const message = elements.chatInput.value.trim();
            if (message) {
                addUserMessage(message);
                processUserInput(message);
            }
        }

        // Process User Input and Generate Responses
        function processUserInput(input) {
            // Normalize input
            const normalizedInput = input.toLowerCase();
            
            // Check for budget keywords
            if (normalizedInput.includes('1500') || normalizedInput.includes('1500 alatt')) {
                chatBotState.currentBudget = 1500;
                recommendProductsByBudget(1500);
            } 
            else if (normalizedInput.includes('2500') || normalizedInput.includes('2500 alatt')) {
                chatBotState.currentBudget = 2500;
                recommendProductsByBudget(2500);
            } 
            else if (normalizedInput.includes('2500 felett')) {
                chatBotState.currentBudget = 2501;
                recommendProductsByBudget(2501);
            }
            // Check for category keywords
            else if (normalizedInput.includes('foci') || normalizedInput.includes('futball')) {
                chatBotState.currentCategory = 'foci';
                recommendProductsByCategory('foci');
            }
            // Check for numbered cards request
            else if (normalizedInput.includes('számozott') || normalizedInput.includes('garantált')) {
                chatBotState.wantsNumbered = true;
                recommendNumberedProducts();
            }
            // Reset filters
            else if (normalizedInput.includes('újrakezd') || normalizedInput.includes('visszaállít')) {
                chatBotState.currentBudget = null;
                chatBotState.currentCategory = null;
                chatBotState.wantsNumbered = false;
                addBotMessage('Szűrők visszaállítva. Miben segíthetek?', [
                    '1500 Ft alatt ajánlj kártyát',
                    '2500 Ft alatt ajánlj kártyát',
                    '2500 Ft felett ajánlj kártyát',
                    'Foci kártyákat keresek',
                    'Garantált számozott kártyát szeretnék'
                ]);
            }
            // General help
            else if (normalizedInput.includes('segítség') || normalizedInput.includes('segíts')) {
                addBotMessage('Miben segíthetek? Kérdezzen bátran a kártyáinkról! Választhat a gyorsválaszok közül vagy írjon saját kérdést.', [
                    '1500 Ft alatt ajánlj kártyát',
                    '2500 Ft alatt ajánlj kártyát',
                    '2500 Ft felett ajánlj kártyát',
                    'Foci kártyákat keresek',
                    'Garantált számozott kártyát szeretnék'
                ]);
            }
            // Default response
            else {
                addBotMessage('Nem teljesen értem a kérdését. Kérlek, válassz a gyorsválaszok közül vagy fogalmazd újra a kérdésedet.', [
                    '1500 Ft alatt ajánlj kártyát',
                    '2500 Ft alatt ajánlj kártyát',
                    '2500 Ft felett ajánlj kártyát',
                    'Foci kártyákat keresek',
                    'Garantált számozott kártyát szeretnék'
                ]);
            }
        }

        // Recommend Products by Budget
        function recommendProductsByBudget(budget) {
            let filteredProducts = [...state.products];
            
            // Filter by budget
            if (budget === 1500) {
                filteredProducts = filteredProducts.filter(p => p.price <= 1500);
            } else if (budget === 2500) {
                filteredProducts = filteredProducts.filter(p => p.price > 1500 && p.price <= 2500);
            } else {
                filteredProducts = filteredProducts.filter(p => p.price > 2500);
            }
            
            // Filter by category if set
            if (chatBotState.currentCategory === 'foci') {
                filteredProducts = filteredProducts.filter(p => 
                    p.category === 'foci'
                );
            }
            
            // Filter by numbered if requested
            if (chatBotState.wantsNumbered) {
                filteredProducts = filteredProducts.filter(p => 
                    p.numbered === true
                );
            }
            
            // Sort by price ascending
            filteredProducts.sort((a, b) => a.price - b.price);
            
            // Generate message based on budget
            let message = '';
            if (budget === 1500) {
                message = 'Íme néhány kiváló kártya 1500 Ft alatt:';
            } else if (budget === 2500) {
                message = 'Íme néhány kiváló kártya 1500 és 2500 Ft között:';
            } else {
                message = 'Íme néhány prémium kártya 2500 Ft felett:';
            }
            
            // Add category info if set
            if (chatBotState.currentCategory === 'foci') {
                message += ' (focitémájú kártyák)';
            }
            
            // Add numbered info if requested
            if (chatBotState.wantsNumbered) {
                message += ' (garantált számozott kártyák)';
            }
            
            // Limit to 3 recommendations
            const recommendations = filteredProducts.slice(0, 3);
            
            if (recommendations.length === 0) {
                addBotMessage('Sajnos nincs ilyen kategóriájú termék a kínálatunkban. Kérlek, próbálj más szűrőket.', [
                    '1500 Ft alatt ajánlj kártyát',
                    '2500 Ft alatt ajánlj kártyát',
                    '2500 Ft felett ajánlj kártyát',
                    'Foci kártyákat keresek',
                    'Garantált számozott kártyát szeretnék',
                    'Szűrők visszaállítása'
                ]);
            } else {
                addBotMessage(message, [
                    'Még több ajánlat',
                    'Más kategória',
                    'Szűrők visszaállítása'
                ], recommendations);
            }
        }

        // Recommend Products by Category
        function recommendProductsByCategory(category) {
            if (category === 'foci') {
                // If budget is already set, use that
                if (chatBotState.currentBudget) {
                    recommendProductsByBudget(chatBotState.currentBudget);
                } else {
                    // Otherwise show general football cards
                    const filteredProducts = [...state.products].filter(p => 
                        p.category === 'foci'
                    ).sort((a, b) => a.price - b.price);
                    
                    const recommendations = filteredProducts.slice(0, 3);
                    
                    if (recommendations.length === 0) {
                        addBotMessage('Sajnos jelenleg nincs focitémájú kártyánk raktáron.', [
                            '1500 Ft alatt ajánlj kártyát',
                            '2500 Ft alatt ajánlj kártyát',
                            '2500 Ft felett ajánlj kártyát',
                            'Garantált számozott kártyát szeretnék',
                            'Szűrők visszaállítása'
                        ]);
                    } else {
                        addBotMessage('Íme néhány kiváló focitémájú kártyánk:', [
                            'Még több ajánlat',
                            'Más kategória',
                            'Szűrők visszaállítása'
                        ], recommendations);
                    }
                }
            }
        }

        // Recommend Numbered Products
        function recommendNumberedProducts() {
            const filteredProducts = [...state.products].filter(p => 
                p.numbered === true
            ).sort((a, b) => a.price - b.price);
            
            const recommendations = filteredProducts.slice(0, 3);
            
            if (recommendations.length === 0) {
                addBotMessage('Sajnos jelenleg nincs garantált számozott kártyánk raktáron.', [
                    '1500 Ft alatt ajánlj kártyát',
                    '2500 Ft alatt ajánlj kártyát',
                    '2500 Ft felett ajánlj kártyát',
                    'Foci kártyákat keresek',
                    'Szűrők visszaállítása'
                ]);
            } else {
                addBotMessage('Íme néhány garantált számozott kártya készletünk:', [
                    'Még több ajánlat',
                    'Más kategória',
                    'Szűrők visszaállítása'
                ], recommendations);
            }
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
